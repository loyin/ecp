package net.loyin.ctrl;

import java.util.ArrayList;
import java.util.List;

import com.jfinal.plugin.activerecord.Db;
import com.jfinal.plugin.activerecord.Page;
import com.jfinal.plugin.activerecord.Record;

import net.loyin.jfinal.anatation.RouteBind;
import net.loyin.model.sys.OperaLog;
import net.loyin.model.sys.Role;
import net.loyin.model.sys.User;
/**系统日志 */
@RouteBind(path = "/operalog")
public class OperaLogCtrl extends AdminBaseController<OperaLog> {
public OperaLogCtrl(){
	this.modelClass=OperaLog.class;
	this.tableName=OperaLog.tableName;
}
public void list(){
	List<Object> param = new ArrayList<Object>();
	StringBuffer where = new StringBuffer();
	/** 添加查询字段条件*/
	qryField(where, param);
	String ctime_ge=this.getPara("ctime$ge");
	if(ctime_ge!=null&&!"".equals(ctime_ge.trim())){
		where.append(" and ctime >=?");
		param.add(ctime_ge+" 00:00:00");
	}
	String ctime_le=this.getPara("ctime$le");
	if(ctime_le!=null&&!"".equals(ctime_le.trim())){
		where.append(" and ctime <=?");
		param.add(ctime_le+" 23:59:59");
	}
	String ip=this.getPara("ip");
	if(ip!=null&&!"".equals(ip.trim())){
		where.append(" and t.ip like ?");
		param.add("%"+ip+"%");
	}
	if(sortField(where)==false)
		where.append(" order by t.id desc");
	Page<Record> p = Db.paginate(getPageNo(), getPageSize(), "select t.*,u.*,r.* ", "from " + this.tableName+ " t,"+User.tableName+" u,"+Role.tableName+" r where r.id=u.role_id and u.id=t.uid " + where.toString(), param.toArray());
	this.setAttr("page", p);
	this.keepPara();
}
}
